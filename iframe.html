<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>eventsource for h6tv</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="eventsource.js"></script>
  <script>

var Cookie = {
  setItem: function (name, value) {
    value = String(value);
	document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + "; expires=" + (new Date(+(new Date()) + 15552000000)).toUTCString() + "; path=/";
	return value; 
  }
};

    var es = null;

    window.addEventListener('message', function (event) {
      if (event.origin !== 'http://hostel6.ru') {
        return;
      }
      var x = null;
      try {
        x = JSON.parse(event.data);
      } catch (e) {
      }
      if (!x || !x.streamURL) {
        return;
      }

      Cookie.setItem('kuid', x.kuid);
      Cookie.setItem('secondpass', x.secondpass);
      var streamURL = x.streamURL
      var wantsCompressed = x.wantsCompressed ? 1 : 0;

      if (es) { //?
        es.close();
      }
      es = new EventSource('/events?streamURL=' + decodeURIComponent(streamURL) '&wantsCompressed=' + wantsCompressed);
      es.addEventListener('message', function (event) {
        window.parent.postMessage(event.data, '*');
      }, false);
    }, false);

  </script>
</head>
<body>
</body>
</html>