<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>eventsource for h6tv</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <script src="eventsource.js"></script>
  <script>
    var parentOrigin = '';
    var es = null;

    try {
      parentOrigin = window.parent.location.protocol + '//' + window.parent.location.host;
    } catch (e) {}

    window.addEventListener('message', function (event) {
      if (event.origin !== parentOrigin) {
        return;
      }
      var x = null;
      try {
        x = JSON.parse(event.data);
      } catch (e) {
      }
      if (!x || !x.streamURL) {
        return;
      }

      // Cookie.setItem('kuid', kuid)
      // Cookie.setItem('secondpass', secondpass)
      var streamURL = x.streamURL
      var wantsCompressed = x.wantsCompressed ? 1 : 0;

      if (es) { //?
        es.close();
      }
      es = new EventSource('/events/' + decodeURIComponent(streamURL) '/' + wantsCompressed);
      es.addEventListener('message', function (event) {
        window.parent.postMessage(event.data, '*');
      }, false);
    }, false);

  </script>
</head>
<body>
</body>
</html>